<!DOCTYPE html>
<html lang="en">
    <!-- This is /mastermind.html -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastermind</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #ecf0f1;
            --text-color: #34495e;
            --tile-color: #e67e22;
            --tile-text-color: #ffffff;
            --feedback-black: #2c3e50;
            --feedback-white: #bdc3c7;
            --dent-color: #bdc3c7;
            --highlight-color: #e74c3c;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 24px;
        }
        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 500px;
        }
        #game-board {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 10px;
            width: 100%;
        }
        .row {
            display: flex;
            margin-bottom: 5px;
            align-items: center;
            opacity: 0.5;
            transition: opacity 0.3s ease;
            width: 100%;
            justify-content: center;
        }
        .row.active {
            opacity: 1;
        }
        .dent {
            width: 30px;
            height: 30px;
            background-color: var(--dent-color);
            border-radius: 50%;
            margin-right: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .dent.selected {
            border: 2px solid var(--highlight-color);
        }
        .tile {
            width: 28px;
            height: 28px;
            margin: 5px;
            background-color: var(--tile-color);
            color: var(--tile-text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50%;
            cursor: move;
        }
        .dent .tile {
            width: 26px;
            height: 26px;
            margin: 0;
            font-size: 16px;
        }        
        .feedback-area {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 10px;
            border: 2px solid var(--primary-color);
            border-radius: 5px;
        }
        .feedback {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap: 2px;
            padding: 2px;
        }
        .peg {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .black {
            background-color: var(--feedback-black);
        }
        .white {
            background-color: var(--feedback-white);
        }
        #digit-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            max-width: 200px;
        }
        #digit-selector .tile {
            margin: 5px;
        }
        select, button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            margin: 5px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        select:hover, button:hover {
            background-color: var(--secondary-color);
        }
        #message {
            font-weight: bold;
            margin-top: 10px;
            text-align: center;
        }
        .language-selector {
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .language-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            margin: 0 5px;
            opacity: 0.7;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .language-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        .language-btn.active {
            opacity: 1;
            font-weight: bold;
            text-shadow: 0 0 10px var(--highlight-color);
        }
        .submit-guess {
            font-size: 20px;
            cursor: pointer;
        }
        .digit-btn {
            width: 40px;
            height: 40px;
            margin: 5px;
            font-size: 18px;
            background-color: var(--tile-color);
            color: var(--tile-text-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .clear-btn {
            width: auto;
            padding: 0 10px;
        }
        .digit-btn:hover {
            background-color: var(--secondary-color);
        }
        .tile-container, .button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 10px;
        }
        @media (max-width: 480px) {
            .dent {
                width: 25px;
                height: 25px;
            }
            .dent .tile {
                width: 23px;
                height: 23px;
                font-size: 14px;
            }
            .feedback-area {
                width: 35px;
                height: 35px;
            }
            .peg {
                width: 10px;
                height: 10px;
            }
            .digit-btn {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }
        @media (max-width: 600px) {
            .tile-container {
                display: none;
            }
        }
        
        @media (min-width: 601px) {
            .button-container {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="languageSelector" class="language-selector"></div>
        <h1 id="title">Mastermind</h1>
        <div style="display: flex; align-items: center; margin-bottom: 10px;">
            <select id="difficulty-selector">
                <option value="easy" id="easy">Easy (12 attempts)</option>
                <option value="medium" id="medium">Medium (10 attempts)</option>
                <option value="hard" id="hard" selected>Hard (8 attempts)</option>
            </select>
            <button id="new-game">New Game</button>
        </div>
        <div id="game-board"></div>
        <div id="digit-selector"></div>
        <div id="message"></div>
    </div>

    <script>
        const languages = {
            'en': { emoji: 'üá¨üáß', name: 'English' },
            'de': { emoji: 'üá©üá™', name: 'Deutsch' },
            'fr': { emoji: 'üá´üá∑', name: 'Fran√ßais' },
            'it': { emoji: 'üáÆüáπ', name: 'Italiano' },
            'sv': { emoji: 'üá∏üá™', name: 'Svenska' },
            'sk': { emoji: 'üá∏üá∞', name: 'Slovenƒçina' },
            'es': { emoji: 'üá™üá∏', name: 'Espa√±ol' },
            'pt': { emoji: 'üáµüáπ', name: 'Portugu√™s' },
            'no': { emoji: 'üá≥üá¥', name: 'Norsk' },
            'fi': { emoji: 'üá´üáÆ', name: 'Suomi' },
            'pl': { emoji: 'üáµüá±', name: 'Polski' },
            'cs': { emoji: 'üá®üáø', name: 'ƒåe≈°tina' }
        };
        
        const translations = {
            'en': {
                title: 'Mastermind',
                easy: 'Easy (12 attempts)',
                medium: 'Medium (10 attempts)',
                hard: 'Hard (8 attempts)',
                newGame: 'New Game',
                win: 'Congratulations! You\'ve cracked the code!',
                lose: 'Game over! The code was: ',
                selectDifficulty: 'Select difficulty to start a new game.'
            },
            'de': {
                title: 'Mastermind',
                easy: 'Einfach (12 Versuche)',
                medium: 'Mittel (10 Versuche)',
                hard: 'Schwer (8 Versuche)',
                newGame: 'Neues Spiel',
                win: 'Gl√ºckwunsch! Du hast den Code geknackt!',
                lose: 'Spiel vorbei! Der Code war: ',
                selectDifficulty: 'W√§hle den Schwierigkeitsgrad, um ein neues Spiel zu starten.'
            },
            'fr': {
                title: 'Mastermind',
                easy: 'Facile (12 essais)',
                medium: 'Moyen (10 essais)',
                hard: 'Difficile (8 essais)',
                newGame: 'Nouvelle Partie',
                win: 'F√©licitations ! Vous avez d√©chiffr√© le code !',
                lose: 'Partie termin√©e ! Le code √©tait : ',
                selectDifficulty: 'S√©lectionnez la difficult√© pour commencer une nouvelle partie.'
            },
            'it': {
                title: 'Mastermind',
                easy: 'Facile (12 tentativi)',
                medium: 'Medio (10 tentativi)',
                hard: 'Difficile (8 tentativi)',
                newGame: 'Nuova Partita',
                win: 'Congratulazioni! Hai decifrato il codice!',
                lose: 'Game over! Il codice era: ',
                selectDifficulty: 'Seleziona la difficolt√† per iniziare una nuova partita.'
            },
            'sv': {
                title: 'Mastermind',
                easy: 'L√§tt (12 f√∂rs√∂k)',
                medium: 'Medel (10 f√∂rs√∂k)',
                hard: 'Sv√•r (8 f√∂rs√∂k)',
                newGame: 'Nytt Spel',
                win: 'Grattis! Du har kn√§ckt koden!',
                lose: 'Spelet √§r √∂ver! Koden var: ',
                selectDifficulty: 'V√§lj sv√•righetsgrad f√∂r att starta ett nytt spel.'
            },
            'sk': {
                title: 'Mastermind',
                easy: 'ƒΩahk√© (12 pokusov)',
                medium: 'Stredn√© (10 pokusov)',
                hard: '≈§a≈æk√© (8 pokusov)',
                newGame: 'Nov√° Hra',
                win: 'Blaho≈æel√°me! Rozl√∫≈°tili ste k√≥d!',
                lose: 'Hra skonƒçila! K√≥d bol: ',
                selectDifficulty: 'Vyberte obtia≈ænos≈• pre zaƒçatie novej hry.'
            },
            'es': {
                title: 'Mastermind',
                easy: 'F√°cil (12 intentos)',
                medium: 'Medio (10 intentos)',
                hard: 'Dif√≠cil (8 intentos)',
                newGame: 'Nuevo Juego',
                win: '¬°Felicidades! ¬°Has descifrado el c√≥digo!',
                lose: '¬°Juego terminado! El c√≥digo era: ',
                selectDifficulty: 'Selecciona la dificultad para comenzar un nuevo juego.'
            },
            'pt': {
                title: 'Mastermind',
                easy: 'F√°cil (12 tentativas)',
                medium: 'M√©dio (10 tentativas)',
                hard: 'Dif√≠cil (8 tentativas)',
                newGame: 'Novo Jogo',
                win: 'Parab√©ns! Voc√™ decifrou o c√≥digo!',
                lose: 'Fim de jogo! O c√≥digo era: ',
                selectDifficulty: 'Selecione a dificuldade para iniciar um novo jogo.'
            },
            'no': {
                title: 'Mastermind',
                easy: 'Lett (12 fors√∏k)',
                medium: 'Middels (10 fors√∏k)',
                hard: 'Vanskelig (8 fors√∏k)',
                newGame: 'Nytt Spill',
                win: 'Gratulerer! Du har knekket koden!',
                lose: 'Spillet er over! Koden var: ',
                selectDifficulty: 'Velg vanskelighetsgrad for √• starte et nytt spill.'
            },
            'fi': {
                title: 'Mastermind',
                easy: 'Helppo (12 yrityst√§)',
                medium: 'Keskitaso (10 yrityst√§)',
                hard: 'Vaikea (8 yrityst√§)',
                newGame: 'Uusi Peli',
                win: 'Onnittelut! Olet murtanut koodin!',
                lose: 'Peli p√§√§ttyi! Koodi oli: ',
                selectDifficulty: 'Valitse vaikeustaso aloittaaksesi uuden pelin.'
            },
            'pl': {
                title: 'Mastermind',
                easy: '≈Åatwy (12 pr√≥b)',
                medium: '≈öredni (10 pr√≥b)',
                hard: 'Trudny (8 pr√≥b)',
                newGame: 'Nowa Gra',
                win: 'Gratulacje! Rozszyfrowa≈Çe≈õ kod!',
                lose: 'Koniec gry! Kod to: ',
                selectDifficulty: 'Wybierz poziom trudno≈õci, aby rozpoczƒÖƒá nowƒÖ grƒô.'
            },
            'cs': {
                title: 'Mastermind',
                easy: 'Lehk√Ω (12 pokus≈Ø)',
                medium: 'St≈ôedn√≠ (10 pokus≈Ø)',
                hard: 'Tƒõ≈æk√Ω (8 pokus≈Ø)',
                newGame: 'Nov√° Hra',
                win: 'Gratulujeme! Rozlu≈°tili jste k√≥d!',
                lose: 'Hra skonƒçila! K√≥d byl: ',
                selectDifficulty: 'Vyberte obt√≠≈ænost pro zah√°jen√≠ nov√© hry.'
            }
        };

        let currentLanguage = 'en';
        let secretCode = [];
        let attempts = 0;
        let maxAttempts = 0;
        let gameActive = false;

        function detectBrowserLanguage() {
            const browserLang = navigator.language.split('-')[0];
            return languages[browserLang] ? browserLang : 'en';
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            const translation = translations[lang] || translations['en'];
            
            // Update text content
            document.title = translation.title;
            document.getElementById('title').textContent = translation.title;
            document.getElementById('easy').textContent = translation.easy;
            document.getElementById('medium').textContent = translation.medium;
            document.getElementById('hard').textContent = translation.hard;
            document.getElementById('new-game').textContent = translation.newGame;
            updateMessage(translation.selectDifficulty);
        
            // Highlight the selected language button
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
            });
        }

        function createLanguageButtons() {
            const languageSelector = document.getElementById('languageSelector');
            for (const [langCode, langInfo] of Object.entries(languages)) {
                const btn = document.createElement('button');
                btn.innerHTML = `${langInfo.emoji} ${langInfo.name}`;
                btn.className = 'language-btn';
                btn.setAttribute('data-lang', langCode);
                btn.onclick = () => setLanguage(langCode);
                languageSelector.appendChild(btn);
            }
        }

        function generateSecretCode() {
            secretCode = [];
            for (let i = 0; i < 4; i++) {
                secretCode.push(Math.floor(Math.random() * 9) + 1);
            }
        }

        function createGameBoard() {
            const gameBoard = document.getElementById('game-board');
            gameBoard.innerHTML = '';
            for (let i = 0; i < 12; i++) {
                const row = document.createElement('div');
                row.className = 'row';
                row.dataset.row = i;
                for (let j = 0; j < 4; j++) {
                    const dent = document.createElement('div');
                    dent.className = 'dent';
                    dent.dataset.col = j;
                    dent.ondrop = drop;
                    dent.ondragover = allowDrop;
                    dent.onclick = selectDent;
                    row.appendChild(dent);
                }
                const feedbackArea = document.createElement('div');
                feedbackArea.className = 'feedback-area';
                const submitGuess = document.createElement('div');
                submitGuess.className = 'submit-guess';
                submitGuess.textContent = '?';
                submitGuess.onclick = () => checkRow(i);
                feedbackArea.appendChild(submitGuess);
                row.appendChild(feedbackArea);
                gameBoard.appendChild(row);
            }
        }

        let selectedDent = null;

        function selectDent(event) {
            if (!gameActive || parseInt(event.target.parentElement.dataset.row) !== attempts) {
                return;
            }
            if (selectedDent) {
                selectedDent.classList.remove('selected');
            }
            selectedDent = event.target;
            selectedDent.classList.add('selected');
        }

        function createDigitSelector() {
            const digitSelector = document.getElementById('digit-selector');
            digitSelector.innerHTML = '';
            
            // Draggable tiles
            const tileContainer = document.createElement('div');
            tileContainer.className = 'tile-container';
            for (let i = 1; i <= 9; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.textContent = i;
                tile.draggable = true;
                tile.ondragstart = drag;
                tile.ontouchstart = touchStart;
                tile.ontouchmove = touchMove;
                tile.ontouchend = touchEnd;
                tileContainer.appendChild(tile);
            }
            digitSelector.appendChild(tileContainer);
        
            // Buttons for touch/click input
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'button-container';
            for (let i = 1; i <= 9; i++) {
                const button = document.createElement('button');
                button.className = 'digit-btn';
                button.textContent = i;
                button.onclick = () => placeTile(i);
                buttonContainer.appendChild(button);
            }
            const clearButton = document.createElement('button');
            clearButton.className = 'digit-btn clear-btn';
            clearButton.textContent = 'Clear';
            clearButton.onclick = clearTile;
            buttonContainer.appendChild(clearButton);
            digitSelector.appendChild(buttonContainer);
        }

        let draggedTile = null;
        let touchStartX, touchStartY;

        function touchStart(event) {
            event.preventDefault();
            draggedTile = event.target.cloneNode(true);
            draggedTile.style.position = 'absolute';
            draggedTile.style.zIndex = 1000;
            document.body.appendChild(draggedTile);
            
            const touch = event.touches[0];
            touchStartX = touch.clientX - event.target.offsetLeft;
            touchStartY = touch.clientY - event.target.offsetTop;
            
            positionDraggedTile(touch.clientX, touch.clientY);
        }

        function touchMove(event) {
            event.preventDefault();
            if (draggedTile) {
                const touch = event.touches[0];
                positionDraggedTile(touch.clientX, touch.clientY);
            }
        }

        function touchEnd(event) {
            event.preventDefault();
            if (draggedTile) {
                const touch = event.changedTouches[0];
                const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
                
                if (dropTarget && dropTarget.classList.contains('dent')) {
                    const row = dropTarget.parentElement;
                    if (parseInt(row.dataset.row) === attempts && row.classList.contains('active')) {
                        dropTarget.innerHTML = '';
                        dropTarget.appendChild(draggedTile.cloneNode(true));
                        checkRowComplete(row);
                    }
                }
                
                document.body.removeChild(draggedTile);
                draggedTile = null;
            }
        }

        function positionDraggedTile(x, y) {
            draggedTile.style.left = (x - touchStartX) + 'px';
            draggedTile.style.top = (y - touchStartY) + 'px';
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.textContent);
        }
        
        function allowDrop(ev) {
            ev.preventDefault();
        }
        
        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            if (ev.target.classList.contains('dent') && ev.target.children.length === 0) {
                const row = ev.target.parentElement;
                if (parseInt(row.dataset.row) === attempts && row.classList.contains('active')) {
                    placeTile(data, ev.target);
                }
            }
        }

        function checkRowComplete(row) {
            const submitGuess = row.querySelector('.submit-guess');
            submitGuess.style.cursor = row.querySelectorAll('.tile').length === 4 ? 'pointer' : 'not-allowed';
            submitGuess.style.opacity = row.querySelectorAll('.tile').length === 4 ? '1' : '0.5';
        }

        function checkRow(rowIndex) {
            if (!gameActive || rowIndex !== attempts) return;
            
            const row = document.querySelector(`.row[data-row="${rowIndex}"]`);
            const tiles = row.querySelectorAll('.tile');
            if (tiles.length === 4) {
                const guess = Array.from(tiles).map(tile => parseInt(tile.textContent));
                const feedback = checkGuess(guess);
                updateFeedbackDisplay(rowIndex, feedback);
                row.classList.remove('active');
                attempts++;
                if (attempts < maxAttempts) {
                    document.querySelector(`.row[data-row="${attempts}"]`).classList.add('active');
                }
                if (feedback.black === 4) {
                    gameActive = false;
                    updateMessage(translations[currentLanguage].win);
                } else if (attempts === maxAttempts) {
                    gameActive = false;
                    updateMessage(translations[currentLanguage].lose + secretCode.join(''));
                }
            }
        }

        function checkGuess(guess) {
            let black = 0;
            let white = 0;
            const codeCopy = [...secretCode];
            const guessCopy = [...guess];

            for (let i = 0; i < 4; i++) {
                if (guessCopy[i] === codeCopy[i]) {
                    black++;
                    codeCopy[i] = guessCopy[i] = null;
                }
            }

            for (let i = 0; i < 4; i++) {
                if (guessCopy[i] !== null) {
                    const index = codeCopy.indexOf(guessCopy[i]);
                    if (index !== -1) {
                        white++;
                        codeCopy[index] = null;
                    }
                }
            }

            return { black, white };
        }

        function updateFeedbackDisplay(rowIndex, feedback) {
            const row = document.querySelector(`.row[data-row="${rowIndex}"]`);
            const feedbackArea = row.querySelector('.feedback-area');
            feedbackArea.innerHTML = '';
            const feedbackDiv = document.createElement('div');
            feedbackDiv.className = 'feedback';

            for (let i = 0; i < feedback.black; i++) {
                const peg = document.createElement('div');
                peg.className = 'peg black';
                feedbackDiv.appendChild(peg);
            }
            for (let i = 0; i < feedback.white; i++) {
                const peg = document.createElement('div');
                peg.className = 'peg white';
                feedbackDiv.appendChild(peg);
            }
            for (let i = 0; i < 4 - feedback.black - feedback.white; i++) {
                const peg = document.createElement('div');
                peg.className = 'peg';
                feedbackDiv.appendChild(peg);
            }
            feedbackArea.appendChild(feedbackDiv);
        }

        document.addEventListener('keydown', handleKeyPress);

        function handleKeyPress(event) {
            if (!gameActive || !selectedDent) {
                return;
            }
            
            if (event.key >= '1' && event.key <= '9') {
                placeTile(event.key);
            } else if (event.key === 'Backspace' || event.key === 'Delete') {
                clearTile();
            }
        }

        function placeTile(digit, target = null) {
            const dent = target || selectedDent;
            if (dent && dent.children.length === 0 && dent.closest('.row').classList.contains('active')) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.textContent = digit;
                dent.appendChild(tile);
                checkRowComplete(dent.parentElement);
            }
        }

        function clearTile() {
            if (selectedDent.children.length > 0) {
                selectedDent.innerHTML = '';
                checkRowComplete(selectedDent.parentElement);
            }
        }

        function updateMessage(message) {
            document.getElementById('message').textContent = message;
        }

        function startNewGame() {
            const difficulty = document.getElementById('difficulty-selector').value;
            switch (difficulty) {
                case 'easy':
                    maxAttempts = 12;
                    break;
                case 'medium':
                    maxAttempts = 10;
                    break;
                case 'hard':
                default:
                    maxAttempts = 8;
                    break;
            }
            attempts = 0;
            generateSecretCode();
            updateGameBoard();
            gameActive = true;
            updateMessage('');
        }

        function updateGameBoard() {
            const rows = document.querySelectorAll('.row');
            rows.forEach((row, index) => {
                row.querySelectorAll('.dent').forEach(dent => dent.innerHTML = '');
                row.querySelector('.feedback-area').innerHTML = '<div class="submit-guess">?</div>';
                if (index < maxAttempts) {
                    row.style.display = 'flex';
                    row.classList.remove('active');
                } else {
                    row.style.display = 'none';
                }
            });
            rows[0].classList.add('active');
        }

        function updateDifficultySelector() {
            const selector = document.getElementById('difficulty-selector');
            selector.value = maxAttempts === 12 ? 'easy' : (maxAttempts === 10 ? 'medium' : 'hard');
        }

        createLanguageButtons();
        createDigitSelector();
        createGameBoard();
        
        const initialLanguage = detectBrowserLanguage();
        setLanguage(initialLanguage);

        document.getElementById('difficulty-selector').addEventListener('change', startNewGame);
        document.getElementById('new-game').addEventListener('click', startNewGame);
        startNewGame();
        updateDifficultySelector();
        
    </script>
</body>